# EscrowAccountQuery V2
# 
# This query is used to retrieve escrow account information for TAP v2/Horizon.
#
# Input Variables:
# - $indexer (Bytes!): The address of the Indexer whose escrow accounts are being queried.
# - $thawEndTimestamp (BigInt!): A timestamp used to filter signers whose thaw period has ended or is about to end.
#
# Query Logic:
# - Fetches escrow accounts where the `receiver` is the provided $indexer.
# - Returns the following information for each escrow account:
#   - `balance`: The current balance of the escrow account.
#   - `totalAmountThawing`: The total amount currently thawing in the escrow.
# - Retrieves the payer (was sender in v1) and filters the payer's `signers` based on:
#   - `thawEndTimestamp_lte`: Only includes signers whose thaw end timestamp is less than or equal to the provided $thawEndTimestamp.
#   - `isAuthorized: true`: Only includes signers that are authorized.
#
# Key differences from v1:
# - Uses Bytes instead of ID for indexer parameter
# - References 'payer' instead of 'sender'
# - Compatible with TAP v2 schema structure

query EscrowAccountQuery($indexer: Bytes!, $thawEndTimestamp: BigInt!) {
    escrowAccounts(where: { receiver: $indexer }) {
        balance
        totalAmountThawing
        payer {
            id
            signers(where: {
                thawEndTimestamp_lte: $thawEndTimestamp
                isAuthorized: true
            }) {
                id
            }
        }
    }
}